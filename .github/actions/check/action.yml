name: build and check fastfetch
description: builds and checks fastfetch

runs:
  using: composite
  steps:
  - name: install required packages
    shell: sh
    run: sudo apt-get update && sudo apt-get install -y libpci-dev libvulkan-dev libwayland-dev libxrandr-dev libxcb-randr0-dev libdconf-dev libdbus-1-dev libxfconf-0-dev librpm-dev libzstd-dev

  - name: Initialize CodeQL
    uses: github/codeql-action/init@v1
    with:
      languages: ${{ matrix.language }}

  - name: configure project
    shell: sh
    # We reuse the build binary only for the releases.
    # We set tweak version to off, because it is wrong, as git tag will happen after this step. Releases don't have a tweak, so this is ok.
    run: cmake -DSET_TWEAK=Off .

  - name: build project
    shell: sh
    run: cmake --build . -j$(nproc)

  - name: run fastfetch
    shell: sh
    run: ./fastfetch --recache --disable-linewrap false --hide-cursor false --show-errors true

  - name: run flashfetch
    shell: sh
    run: ./flashfetch

  - name: run tests
    shell: sh
    run: ctest

  - name: build deb package
    shell: sh
    run: sh packaging/deb/create.sh .

  - name: perform CodeQL analysis
    uses: github/codeql-action/analyze@v1
